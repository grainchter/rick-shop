{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\user\\\\rick-shop\\\\rick-shop\\\\src\\\\components\\\\main\\\\bascet\\\\bascet.js\",\n    _s = $RefreshSig$();\n\nimport s from './bascet.module.scss';\nimport { useEffect, useState } from 'react';\nimport { database } from '../../../firebase/firebase';\nimport { useSelector } from \"react-redux\";\nimport { getUserToken } from '../../../store/user';\nimport Preloader from '../preloader/preloader';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst Bascet = () => {\n  _s();\n\n  let userId = useSelector(getUserToken);\n  const [totalPrice, setPrice] = useState(0);\n  const [loaded, setLoaded] = useState(false);\n  const [data, setData] = useState({});\n  const [array, setArr] = useState([]);\n  const [isLoading, setLoading] = useState(false);\n  useEffect(() => {\n    if (loaded) return;\n    setTimeout(() => {\n      if (userId) {\n        setLoaded(true);\n        getData();\n      }\n    }, 1000);\n  });\n\n  const getData = () => {\n    if (Object.keys(userId).length > 0) {\n      database.ref('/users/' + userId + '/basket/').once('value', snapshot => {\n        const db = snapshot.val();\n\n        if (db != null) {\n          setData(Object.entries(db));\n          setLoading(true);\n        } else {\n          setLoading(true);\n        }\n      });\n    } else {\n      if (JSON.parse(localStorage.getItem(\"data2\")) != null) {\n        setData(JSON.parse(localStorage.getItem(\"data2\")));\n        setLoading(true);\n      } else {\n        setLoading(true);\n      }\n    }\n  };\n\n  const check = id => {\n    let checked = false;\n\n    if (document.getElementById(id).checked === true) {\n      document.getElementById(id).checked = checked;\n      setArr(array.filter(item => item !== id));\n      data.forEach(element => {\n        if (element[1].id === id) {\n          setPrice(totalPrice - element[1].price);\n        }\n      });\n    } else if (document.getElementById(id).checked === false) {\n      document.getElementById(id).checked = !checked;\n      setArr([id].concat(array));\n      data.forEach(element => {\n        if (element[1].id === id) {\n          setPrice(totalPrice + element[1].price);\n        }\n      });\n    }\n  };\n\n  const del = () => {\n    if (Object.keys(userId).length === 0) {\n      for (let i = 0; i <= array.length - 1; i++) {\n        let items = JSON.parse(localStorage.getItem(\"data2\"));\n        items = items.filter(item => item[1].id !== array[i]);\n        localStorage.setItem(\"data2\", JSON.stringify(items));\n      }\n    } else {\n      for (let i = 0; i <= array.length - 1; i++) {\n        database.ref('/users/' + userId + '/basket/' + array[i]).remove();\n      }\n    }\n\n    window.location.reload();\n  };\n\n  const buy = () => {\n    let totalPrice = 0;\n    let randomNum = Math.floor(Math.random() * (50000 - 10000)) + 10000 + Math.round(new Date() / 1000);\n\n    if (Object.keys(userId).length === 0) {\n      alert(\"Нужно зарегистрироваться или авторизоваться\");\n    } else {\n      for (let i = 0; i <= array.length; i++) {\n        for (let j = 0; j <= data.length - 1; j++) {\n          if (array[i] === data[j][1].id) {\n            totalPrice += data[j][1].price;\n            data[j][1].process = \"accepted for work\";\n            database.ref('/users/' + userId + '/orders/' + randomNum + '/items/' + data[j][1].id).set(data[j][1]);\n          }\n        }\n\n        database.ref('/users/' + userId + '/basket/' + array[i]).remove();\n        database.ref('characters/' + array[i]).remove();\n      }\n\n      database.ref().child('/users/' + userId + '/orders/' + randomNum).update({\n        totalPrice: totalPrice\n      });\n      window.location.reload();\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [isLoading === true && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: s.container,\n      children: [Object.values(data).map(([key, {\n        name,\n        id,\n        image,\n        species,\n        status,\n        price\n      }]) => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: s.wrapper,\n        onClick: () => {\n          check(id);\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: s.checkbox,\n          children: /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"checkbox\",\n            id: id,\n            onClick: () => {\n              check(id);\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 145,\n            columnNumber: 37\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 144,\n          columnNumber: 33\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: s.text,\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: name\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 154,\n            columnNumber: 37\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: status\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 155,\n            columnNumber: 37\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: species\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 156,\n            columnNumber: 37\n          }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n            children: [\"$\", price]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 157,\n            columnNumber: 37\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 153,\n          columnNumber: 33\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: s.img,\n          children: /*#__PURE__*/_jsxDEV(\"img\", {\n            src: image,\n            alt: \"\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 160,\n            columnNumber: 37\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 159,\n          columnNumber: 33\n        }, this)]\n      }, key, true, {\n        fileName: _jsxFileName,\n        lineNumber: 137,\n        columnNumber: 29\n      }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: s.totalPrice,\n        children: /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"\\u0418\\u0442\\u043E\\u0433\\u043E \\u0446\\u0435\\u043D\\u0430 $\", totalPrice]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 167,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: s.buy,\n        children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n          children: \"\\u041A\\u0443\\u043F\\u0438\\u0442\\u044C \\u0441\\u0435\\u0439\\u0447\\u0430\\u0441\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 171,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => {\n            buy();\n          },\n          children: \"Buy\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 172,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => {\n            del();\n          },\n          children: \"Clear\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 177,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 17\n    }, this), isLoading === false && /*#__PURE__*/_jsxDEV(\"div\", {\n      children: /*#__PURE__*/_jsxDEV(Preloader, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 188,\n        columnNumber: 21\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 17\n    }, this)]\n  }, void 0, true);\n};\n\n_s(Bascet, \"VmvHZ868jnxwyaqdgEMQWtPAxBQ=\", false, function () {\n  return [useSelector];\n});\n\n_c = Bascet;\nexport default Bascet;\n\nvar _c;\n\n$RefreshReg$(_c, \"Bascet\");","map":{"version":3,"sources":["C:/Users/user/rick-shop/rick-shop/src/components/main/bascet/bascet.js"],"names":["s","useEffect","useState","database","useSelector","getUserToken","Preloader","Bascet","userId","totalPrice","setPrice","loaded","setLoaded","data","setData","array","setArr","isLoading","setLoading","setTimeout","getData","Object","keys","length","ref","once","snapshot","db","val","entries","JSON","parse","localStorage","getItem","check","id","checked","document","getElementById","filter","item","forEach","element","price","concat","del","i","items","setItem","stringify","remove","window","location","reload","buy","randomNum","Math","floor","random","round","Date","alert","j","process","set","child","update","container","values","map","key","name","image","species","status","wrapper","checkbox","text","img"],"mappings":"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","sourcesContent":["\r\nimport s from './bascet.module.scss';\r\n\r\nimport { useEffect, useState } from 'react';\r\n\r\nimport { database } from '../../../firebase/firebase';\r\n\r\nimport { useSelector } from \"react-redux\";\r\nimport { getUserToken } from '../../../store/user';\r\nimport Preloader from '../preloader/preloader';\r\n\r\n\r\nconst Bascet = () => {\r\n\r\n\r\n    let userId = useSelector(getUserToken);\r\n\r\n    const [totalPrice, setPrice] = useState(0);\r\n\r\n    const [loaded, setLoaded] = useState(false);\r\n\r\n    const [data, setData] = useState({});\r\n\r\n    const [array, setArr] = useState([]);\r\n\r\n    const [isLoading, setLoading] = useState(false);\r\n\r\n\r\n    useEffect(() => {\r\n        if (loaded) return;\r\n\r\n        setTimeout(() => {\r\n            if (userId) {\r\n                setLoaded(true);\r\n                getData();\r\n            }\r\n        }, 1000);\r\n\r\n    })\r\n\r\n    const getData = () => {\r\n        if (Object.keys(userId).length > 0) {\r\n            database.ref('/users/' + userId + '/basket/').once('value', (snapshot) => {\r\n                const db = snapshot.val();\r\n                if (db != null) {\r\n                    setData(Object.entries(db));\r\n                    setLoading(true);\r\n                } else {\r\n                    setLoading(true);\r\n                }\r\n            });\r\n        } else {\r\n            if ((JSON.parse(localStorage.getItem(\"data2\")) != null)) {\r\n                setData(JSON.parse(localStorage.getItem(\"data2\")));\r\n                setLoading(true);\r\n            } else {\r\n                setLoading(true);\r\n            }\r\n        }\r\n    }\r\n\r\n    const check = (id) => {\r\n        let checked = false;\r\n        if (document.getElementById(id).checked === true) {\r\n            document.getElementById(id).checked = checked;\r\n            setArr(array.filter(item => item !== id));\r\n            data.forEach(element => {\r\n                if (element[1].id === id) {\r\n                    setPrice(totalPrice - element[1].price);\r\n                }\r\n            });\r\n\r\n\r\n        } else if (document.getElementById(id).checked === false) {\r\n            document.getElementById(id).checked = !checked;\r\n            setArr([id].concat(array));\r\n            data.forEach(element => {\r\n                if (element[1].id === id) {\r\n                    setPrice(totalPrice + element[1].price);\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n\r\n    const del = () => {\r\n\r\n        if (Object.keys(userId).length === 0) {\r\n            for (let i = 0; i <= array.length - 1; i++) {\r\n                let items = JSON.parse(localStorage.getItem(\"data2\"));\r\n                items = items.filter((item) => item[1].id !== array[i]);\r\n                localStorage.setItem(\"data2\", JSON.stringify(items));\r\n            }\r\n\r\n        } else {\r\n            for (let i = 0; i <= array.length - 1; i++) {\r\n                database.ref('/users/' + userId + '/basket/' + array[i]).remove();\r\n            }\r\n        }\r\n        window.location.reload();\r\n\r\n    }\r\n\r\n    const buy = () => {\r\n        let totalPrice = 0;\r\n        let randomNum = (Math.floor(Math.random() * (50000 - 10000)) + 10000) + Math.round(new Date() / 1000);\r\n        if (Object.keys(userId).length === 0) {\r\n            alert(\"Нужно зарегистрироваться или авторизоваться\");\r\n        } else {\r\n            for (let i = 0; i <= array.length; i++) {\r\n                for (let j = 0; j <= data.length - 1; j++) {\r\n                    if (array[i] === data[j][1].id) {\r\n                        totalPrice += data[j][1].price;\r\n                        data[j][1].process = \"accepted for work\";\r\n                        database.ref('/users/' + userId + '/orders/' + randomNum + '/items/' + data[j][1].id).set(data[j][1]);\r\n                    }\r\n                }\r\n                database.ref('/users/' + userId + '/basket/' + array[i]).remove();\r\n                database.ref('characters/' + array[i]).remove();\r\n            }\r\n            database.ref().child('/users/' + userId + '/orders/' + randomNum).update({\r\n                totalPrice: totalPrice\r\n            });\r\n            window.location.reload();\r\n        }\r\n\r\n    }\r\n\r\n    return (\r\n        <>\r\n            {\r\n                (isLoading === true) &&\r\n                <div className={s.container}>\r\n\r\n                    {\r\n                        Object.values(data).map(([key, { name, id, image, species, status, price }]) =>\r\n                            <div className={s.wrapper} key={key} onClick={() => {\r\n\r\n                                check(id);\r\n\r\n                            }\r\n                            }>\r\n\r\n                                <div className={s.checkbox}>\r\n                                    <input type=\"checkbox\" id={id} onClick={() => {\r\n\r\n                                        check(id);\r\n\r\n                                    }\r\n                                    } />\r\n                                </div>\r\n\r\n                                <div className={s.text}>\r\n                                    <p>{name}</p>\r\n                                    <p>{status}</p>\r\n                                    <p>{species}</p>\r\n                                    <h1>${price}</h1>\r\n                                </div>\r\n                                <div className={s.img}>\r\n                                    <img src={image} alt=''></img>\r\n                                </div>\r\n                            </div>\r\n                        )\r\n                    }\r\n\r\n                    <div className={s.totalPrice}>\r\n                        <p>Итого цена ${totalPrice}</p>\r\n                    </div>\r\n\r\n                    <div className={s.buy}>\r\n                        <h1>Купить сейчас</h1>\r\n                        <button onClick={() => {\r\n\r\n                            buy();\r\n\r\n                        }}>Buy</button>\r\n                        <button onClick={() => {\r\n\r\n                            del();\r\n\r\n                        }}>Clear</button>\r\n                    </div>\r\n                </div>\r\n            }\r\n\r\n            {(isLoading === false) &&\r\n                <div>\r\n                    <Preloader />\r\n                </div>\r\n            }\r\n        </>\r\n    );\r\n}\r\n\r\nexport default Bascet;"]},"metadata":{},"sourceType":"module"}